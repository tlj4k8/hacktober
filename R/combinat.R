## Code to read in multiple CSVs, add some detail around number of bedrooms,...
## bind them together for easier manipulation, and create a Long file for visualization

#Installing and loading requisite package for "pivot_longer" later
install.packages('tidyr')
require(tidyr)


# Read several CSVs as independent lists for future combination
# Location Reference is to the root git folder 
one_bedroom_zhvi <- read.csv('./data/zhvi_1br_by_zip.csv', stringsAsFactors = FALSE)
two_bedroom_zhvi <- read.csv('./data/zhvi_2br_by_zip.csv', stringsAsFactors = FALSE)
three_bedroom_zhvi <- read.csv('./data/zhvi_3br_by_zip.csv', stringsAsFactors = FALSE)
four_bedroom_zhvi <- read.csv('./data/zhvi_4br_by_zip.csv', stringsAsFactors = FALSE)
fiveplus_bedroom_zhvi <- read.csv('./data/zhvi_5plusbr_by_zip.csv', stringsAsFactors = FALSE)


# Add variable to each list with number of bedrooms
one_bedroom_zhvi$size <- 'oneBedroom'
two_bedroom_zhvi$size <- 'twoBedroom'
three_bedroom_zhvi$size <- 'threeBedroom'
four_bedroom_zhvi$size <- 'fourBedroom'
fiveplus_bedroom_zhvi$size <- 'fiveplusBedroom'


# Combine like Megazord
combined <- rbind(one_bedroom_zhvi,two_bedroom_zhvi,three_bedroom_zhvi,four_bedroom_zhvi,fiveplus_bedroom_zhvi)


# Make Long for visualization purposes. Dropping NAs for ease of viewing (and viz purposes)
newcombo <- pivot_longer(
  combined,
    cols = starts_with("X"),
    names_to = "Week",
    values_to = "Cost",
    values_drop_na = TRUE
  )


# Remove "X" From Weekname
newcombo$Week <- gsub("X", "", newcombo$Week)


# Drop columns that aren't of interest
combodata <- newcombo[ ,c(3,10:12)]


# Create Head of Data for testing purposes
headdata <- combodata[c(1:10),]


# Write combined csvs for testing and load
write.csv(combodata, './data/combined_zip_zhvi.csv', row.names = FALSE)
write.csv(headdata, './data/head_combined_zip_zhvi.csv', row.names = FALSE)

